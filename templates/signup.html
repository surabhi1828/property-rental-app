<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - Property Rental</title>
    <!-- Links to the new stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/login_signup.css') }}">
</head>
<body>

    <!-- Navbar Section -->
    <nav class="navbar-section">
        <div class="navbar-content container">
            <a href="/" class="navbar-brand">FindHome</a>
            <div class="navbar-links">
                <!-- This link goes back to your ROLE SELECTION page -->
                <a href="{{ url_for('index') }}">LOGIN</a>
            </div>
        </div>
    </nav>

    <!-- Signup Form -->
    <div class="form-container-wrapper">
        <div class="form-container">
            <h2>Register</h2>
            
            <form id="signupForm">
                <div class="form-group">
                    <label for="role">I am a:</label>
                    <select id="role" name="role" required>
                        <option value="" disabled selected>Select Role</option>
                        <option value="owner">Property Owner</option>
                        <option value="tenant">Tenant</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" placeholder="Enter your full name" required>
                </div>

                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" required>
                </div>

                <div class="form-group">
                    <label for="phone">Mobile</label>
                    <input type="tel" id="phone" name="phone" placeholder="Enter 10 digit mobile number" required>
                </div>

                <!-- Fields that appear based on role selection -->
                <div class="form-group" id="ownerFields" style="display:none;">
                    <label for="bank_details">Bank Details (Optional)</label>
                    <input type="text" id="bank_details" name="bank_details" placeholder="Your bank details">
                </div>
                <div class="form-group" id="tenantFields" style="display:none;">
                    <label for="id_proof">ID Proof (Optional)</label>
                    <input type="text" id="id_proof" name="id_proof" placeholder="Aadhar, Passport, etc.">
                </div>

                <button type="submit" class="btn btn-red">Submit</button>

                <!-- <div class="form-link">
                    <p>Already have an account? <a href="{{ url_for('index') }}">Login</a></p>
                </div> -->
            </form>
            
            <p id="message" class="alert" style="display:none;"></p>
        </div>
    </div>

    <script>
        // This is your exact JS from your file, with one change:
        // Instead of alert(), it will show a message on the page.

        document.getElementById('role').addEventListener('change', function() {
            document.getElementById('ownerFields').style.display = 
                this.value === 'owner' ? 'block' : 'none';
            document.getElementById('tenantFields').style.display = 
                this.value === 'tenant' ? 'block' : 'none';
        });

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const role = document.getElementById('role').value;
            const messageEl = document.getElementById('message');
            
            const data = {
                role: role,
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value
            };
            
            if (role === 'owner') {
                data.bank_details = document.getElementById('bank_details').value;
            } else if (role === 'tenant') {
                data.id_proof = document.getElementById('id_proof').value;
            }
            
            try {
                const response = await fetch('/api/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    messageEl.textContent = result.message || 'Account created successfully! Redirecting...';
                    messageEl.className = 'alert alert-success';
                    messageEl.style.display = 'block';
                    
                    setTimeout(() => {
                        // Redirects to the login form for the role they just created
                        window.location.href = '/login-form/' + role;
                    }, 2000);
                } else {
                    messageEl.textContent = 'Signup failed: ' + (result.error || 'Unknown error');
                    messageEl.className = 'alert alert-error';
                    messageEl.style.display = 'block';
                }
            } catch (error) {
                messageEl.textContent = 'Signup failed: ' + error.message;
                messageEl.className = 'alert alert-error';
                messageEl.style.display = 'block';
            }
        });
    </script>
</body>
</html>